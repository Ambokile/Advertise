<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title></title>

    <link href="lib/ionic/css/ionic.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above
    <link href="css/ionic.app.css" rel="stylesheet">
    -->

    <!-- ionic/angularjs js -->
    <script src="lib/ionic/js/ionic.bundle.js"></script>

    <!-- cordova script (this will be a 404 during development) -->
    <script src="cordova.js"></script>

    <!-- your app's js -->
    <script src="js/app.js"></script>
    <script type="text/javascript" src="js/processor.js" ></script>
    <script type="text/javascript">
	
	
        function log_in(){
		  alert();
	 var user_name = document.querySelector("#user_name").value;
	  var password = document.querySelector("#password").value;
	   
	   if(user_name == "" || user_name == null){
	     alert("user_name field is empty");
		 return false; 
	  }
	  
      if(password == "" || password == null){
	       alert("password field is empty");
		   return false;
	  }
	  
	   document.addEventListener("deviceready", onDeviceReady, false);
		                        }
		
		
	   function queryDB(tx) {
		   
    tx.executeSql('SELECT * FROM info where name = "'+user_name+'" AND password = "'+password+'"', [], querySuccess, errorCB);
               }

 function errorCB(err) {
        alert("Error processing SQL: "+err.code);
    }


  
   
   function querySuccess(tx, results) {
	   alert();
	   alert(results.rows.item(i).mobile);
       var id = results.rows.item(i).id;
	   
	    var xmlhttp;
	if(window.XMLHttpRequest){
		xmlhttp = new XMLHttpRequest();
		}
     else{
	    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");}
		
 xmlhttp.onreadystatechange = function(){
	 
	 if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
		 var id = xmlhttp.responseText.search("success");
		   if(id != -1){
			       
			       window.location = "main.html";
			   }
		   else
		        alert("failed to log in, please check if every thing is correct and  try again");
	 }
                                        };
xmlhttp.open("GET","http://fishpond.site88.net/_seine_log_in.php?id="+id,true);
xmlhttp.send();
	  
		return false;	
	}

function onDeviceReady() {
	alert();
               var db = window.openDatabase("Database", "1.0", "PhoneGap info", 200000);
               db.transaction(queryDB,errorCB);
                                 }
	   	
        	

    </script>
    <script src="js/processor.js"></script>
  </head>
  <body ng-app="home">
     
     
      
    <ion-nav-bar class="nav-title-slide-ios7 bar-positive">
    </ion-nav-bar>
    
    <ion-nav-view animation="slide-left-right"></ion-nav-view>


    <script id="home.html" type="text/ng-template"> 
      <ion-view title= "Matangazo">
	   <div class="list list-inset" style="margin-top:30%;">
      
         <form action="" method="">
           <label class="item item-input">
           <i class="icon ion-android-social-user"></i>
              <input type="text" placeholder="jina la mtumiaji" id="user_name" />
           </label>
           <label class="item item-input">
            <i class="icon ion-android-social-user"></i>
             <input type="password" placeholder="Nywila ya mtumiaji" id="password" />
             
           </label>
            <button class="button button-full button-positive" onClick="log_in()">Ingia</button>
            </form>          
     </div>
            <div style=" width:100%; text-align:left;">
               <span style=" margin-left:5%;"><a href="" onClick="document.location.href ='register.html'"  style="font-size:12px; text-decoration:none">- fungua akaunti</a>
            </div>
            <div style=" width:100%; text-align:left;">
                <span style="margin-left:5%;"><a href="" style="font-size:12px; text-decoration:none">- nikumbushe nywila</a></span>
            </div>
      </div>
      </ion-view>
    </script>
  </body>
</html>
